<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Point Roberts Beach Club — Property Intelligence</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    /* ── Reset & base ─────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background: #0f1923;
      color: #e8eaed;
    }

    /* ── Sidebar ──────────────────────────────────────── */
    #sidebar {
      width: 360px;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      background: #141e2a;
      border-right: 1px solid #263545;
      overflow: hidden;
    }

    #sidebar-header {
      padding: 16px 18px 12px;
      background: #0d1621;
      border-bottom: 1px solid #1e3048;
    }
    #sidebar-header h1 {
      font-size: 15px;
      font-weight: 700;
      color: #f0c040;
      letter-spacing: .3px;
    }
    #sidebar-header p {
      font-size: 11px;
      color: #7a9ab5;
      margin-top: 2px;
    }

    /* ── The Reef card ────────────────────────────────── */
    #reef-card {
      margin: 14px 14px 0;
      background: linear-gradient(135deg, #1a2e1a 0%, #162618 100%);
      border: 1.5px solid #3a7d44;
      border-radius: 10px;
      padding: 12px 14px;
    }
    #reef-card .label {
      font-size: 10px;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: #4caf50;
      margin-bottom: 4px;
    }
    #reef-card h2 {
      font-size: 14px;
      font-weight: 700;
      color: #f0c040;
      margin-bottom: 8px;
    }
    .reef-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }
    .reef-stat {
      background: rgba(255,255,255,.05);
      border-radius: 6px;
      padding: 6px 8px;
    }
    .reef-stat .v {
      font-size: 13px;
      font-weight: 700;
      color: #e8eaed;
    }
    .reef-stat .k {
      font-size: 10px;
      color: #7a9ab5;
      margin-top: 1px;
    }
    #reef-card .cta {
      margin-top: 8px;
      width: 100%;
      padding: 7px 0;
      background: #2e7d32;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
    }
    #reef-card .cta:hover { background: #388e3c; }

    /* ── Filter pills ─────────────────────────────────── */
    #filter-section {
      padding: 12px 14px 6px;
    }
    #filter-section .section-title {
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #5a7a94;
      margin-bottom: 7px;
    }
    #filter-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .pill {
      padding: 3px 9px;
      border-radius: 20px;
      font-size: 11px;
      cursor: pointer;
      border: 1.5px solid transparent;
      transition: all .15s;
      white-space: nowrap;
    }
    .pill.active {
      opacity: 1;
    }
    .pill:not(.active) {
      opacity: .45;
      filter: grayscale(60%);
    }
    .pill:hover { opacity: .85; }

    /* ── Property list ────────────────────────────────── */
    #list-section {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding-top: 4px;
    }
    #list-header {
      padding: 6px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #list-header .section-title {
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #5a7a94;
    }
    #count-badge {
      font-size: 11px;
      background: #1e3048;
      color: #7ab5d8;
      padding: 2px 7px;
      border-radius: 10px;
    }
    #search-box {
      margin: 0 14px 6px;
      padding: 6px 10px;
      background: #1e2f40;
      border: 1px solid #263a50;
      border-radius: 6px;
      color: #e8eaed;
      font-size: 12px;
      width: calc(100% - 28px);
    }
    #search-box::placeholder { color: #4a6a80; }
    #search-box:focus { outline: none; border-color: #4a8aaa; }

    #property-list {
      flex: 1;
      overflow-y: auto;
      padding: 0 8px 8px;
      scrollbar-width: thin;
      scrollbar-color: #263545 transparent;
    }
    #property-list::-webkit-scrollbar { width: 5px; }
    #property-list::-webkit-scrollbar-track { background: transparent; }
    #property-list::-webkit-scrollbar-thumb { background: #263545; border-radius: 3px; }

    .property-item {
      padding: 9px 10px;
      border-radius: 7px;
      cursor: pointer;
      display: flex;
      align-items: flex-start;
      gap: 9px;
      margin-bottom: 3px;
      transition: background .15s;
      border: 1px solid transparent;
    }
    .property-item:hover {
      background: #1e3048;
    }
    .property-item.selected {
      background: #1e3048;
      border-color: #2e5070;
    }
    .property-item.is-reef {
      border-color: #3a7d44;
      background: rgba(58,125,68,.12);
    }
    .dot {
      width: 11px;
      height: 11px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 3px;
    }
    .prop-info { flex: 1; min-width: 0; }
    .prop-address {
      font-size: 12px;
      font-weight: 600;
      color: #d0dce8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .prop-owner {
      font-size: 10.5px;
      color: #5a7a94;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .prop-meta {
      text-align: right;
      flex-shrink: 0;
    }
    .prop-value {
      font-size: 11px;
      font-weight: 600;
      color: #7ab5d8;
    }
    .prop-use {
      font-size: 10px;
      color: #4a6a80;
    }

    /* ── Map ──────────────────────────────────────────── */
    #map {
      flex: 1;
      z-index: 1;
    }

    /* ── Custom popup ─────────────────────────────────── */
    .leaflet-popup-content-wrapper {
      background: #141e2a;
      color: #e8eaed;
      border-radius: 10px;
      border: 1.5px solid #263545;
      box-shadow: 0 8px 24px rgba(0,0,0,.5);
      padding: 0;
    }
    .leaflet-popup-tip-container { display: none; }
    .leaflet-popup-content {
      margin: 0;
      min-width: 240px;
    }
    .popup-inner { padding: 14px 16px 12px; }
    .popup-use-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .5px;
      margin-bottom: 6px;
    }
    .popup-address {
      font-size: 14px;
      font-weight: 700;
      color: #f0f4f8;
      margin-bottom: 3px;
    }
    .popup-owner {
      font-size: 11px;
      color: #7a9ab5;
      margin-bottom: 10px;
    }
    .popup-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-bottom: 10px;
    }
    .popup-stat {
      background: rgba(255,255,255,.05);
      border-radius: 6px;
      padding: 6px 8px;
    }
    .popup-stat .v {
      font-size: 13px;
      font-weight: 700;
      color: #e8eaed;
    }
    .popup-stat .k {
      font-size: 10px;
      color: #5a7a94;
    }
    .popup-link {
      display: block;
      text-align: center;
      padding: 6px;
      background: #1e3048;
      border-radius: 6px;
      font-size: 11px;
      color: #5ab5d8;
      text-decoration: none;
      transition: background .15s;
    }
    .popup-link:hover { background: #263a50; }

    /* ── Legend ───────────────────────────────────────── */
    #legend {
      position: absolute;
      bottom: 24px;
      right: 12px;
      z-index: 1000;
      background: rgba(20,30,42,.93);
      border: 1px solid #263545;
      border-radius: 8px;
      padding: 10px 12px;
      min-width: 160px;
      font-size: 11px;
    }
    #legend h4 {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #5a7a94;
      margin-bottom: 7px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 7px;
      margin-bottom: 4px;
      color: #b0c4d8;
    }
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* ── Stats bar ────────────────────────────────────── */
    #stats-bar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      gap: 8px;
    }
    .stat-pill {
      background: rgba(20,30,42,.93);
      border: 1px solid #263545;
      border-radius: 20px;
      padding: 5px 12px;
      font-size: 11px;
      color: #7ab5d8;
      white-space: nowrap;
    }
    .stat-pill strong {
      color: #e8eaed;
      font-weight: 700;
    }
  </style>
</head>
<body>

<!-- ======================== SIDEBAR ======================== -->
<div id="sidebar">
  <div id="sidebar-header">
    <h1>⚓ Point Roberts Beach Club</h1>
    <p>Property Intelligence — Whatcom County GIS Data</p>
  </div>

  <!-- The Reef card -->
  <div id="reef-card">
    <div class="label">Target Acquisition</div>
    <h2>★ The Reef — 1334 Gulf Rd</h2>
    <div class="reef-stats">
      <div class="reef-stat">
        <div class="v">$1,375,000</div>
        <div class="k">Asking Price</div>
      </div>
      <div class="reef-stat">
        <div class="v">$850,965</div>
        <div class="k">Assessed Value</div>
      </div>
      <div class="reef-stat">
        <div class="v">8,463 sqft</div>
        <div class="k">Building Size</div>
      </div>
      <div class="reef-stat">
        <div class="v">Built 1959</div>
        <div class="k">Year Built</div>
      </div>
    </div>
    <button class="cta" id="fly-to-reef">Fly to The Reef &rarr;</button>
  </div>

  <!-- Filters -->
  <div id="filter-section">
    <div class="section-title">Filter by Category</div>
    <div id="filter-pills"></div>
  </div>

  <!-- Property list -->
  <div id="list-section">
    <div id="list-header">
      <span class="section-title">Properties</span>
      <span id="count-badge">—</span>
    </div>
    <input id="search-box" type="text" placeholder="Search address or owner…" />
    <div id="property-list"></div>
  </div>
</div>

<!-- ======================== MAP ======================== -->
<div id="map"></div>

<!-- Stats overlay (injected after data load) -->
<div id="stats-bar" style="display:none"></div>

<!-- Legend overlay -->
<div id="legend">
  <h4>Legend</h4>
  <div id="legend-items"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ── Map init ──────────────────────────────────────────────────
const map = L.map('map', {
  zoomControl: false,
  preferCanvas: true,
}).setView([48.9880, -123.0680], 14);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '© OpenStreetMap, © CARTO',
  subdomains: 'abcd',
  maxZoom: 20,
}).addTo(map);

L.control.zoom({ position: 'topright' }).addTo(map);

// ── Color / category maps ──────────────────────────────────────
const CAT_COLORS = {
  "EATING PLACE":  "#e74c3c",
  "DRINK PLACES":  "#9b59b6",
  "LIQUOR":        "#8e44ad",
  "GAS SERV STA":  "#e67e22",
  "GROCERIES":     "#27ae60",
  "MARINAS":       "#2980b9",
  "OTHR MARINAS":  "#2980b9",
  "GOLF COURSES":  "#1abc9c",
  "GEN RESORTS":   "#1abc9c",
  "RV PARKS":      "#f39c12",
  "MINI STORAGE":  "#95a5a6",
  "WHSE/STORAGE":  "#95a5a6",
  "OTHR WHSE/ST":  "#95a5a6",
  "BANK SERV":     "#2ecc71",
  "POSTAL SERV":   "#3498db",
  "AUTO REP SER":  "#d35400",
  "RE AG/BRKR/M":  "#16a085",
  "BLDG MATERLS":  "#d35400",
  "PHONE COMMUN":  "#7f8c8d",
  "PHONE RELAY":   "#7f8c8d",
  "FIRE PROTECT":  "#e74c3c",
  "POLICE PROTC":  "#1565c0",
  "POSTAL SERV":   "#3498db",
  "PRIMARY SCH":   "#3498db",
  "CHURCHES":      "#8e44ad",
  "LAND/TAKEOFF":  "#2c3e50",
  "TENNIS COURT":  "#26a69a",
  "WATR STORAGE":  "#607d8b",
  "ELEC SERV":     "#ff9800",
  "ELEC REG SUB":  "#ff9800",
  "OSAG RANCHES":  "#558b2f",
  "DESIG FOREST":  "#558b2f",
  "OTHR AG LAND":  "#8bc34a",
};
const PARK_TYPES = new Set(["COMMUNITY PK","DISTRICT PK","NEIGHBRHD PK","OTHER PARK","PLAYGROUNDS"]);
const GOV_TYPES  = new Set(["OTHR GVRN SV","FIRE PROTECT","POLICE PROTC","POSTAL SERV","PRIMARY SCH"]);
const OTHER_TYPES = new Set(["MISC SERV","OTHR BUS SER","OTHR PER SER","OTHR FIN/INS","OTHR MISC SV","OTHR CULT","OTHR WHSE/ST","OTHR GVRN SV"]);

function getColor(use) {
  if (CAT_COLORS[use]) return CAT_COLORS[use];
  if (PARK_TYPES.has(use))  return "#27ae60";
  if (GOV_TYPES.has(use))   return "#3498db";
  if (OTHER_TYPES.has(use)) return "#7f8c8d";
  return "#607d8b";
}

// Category grouping for filter pills
function getCategory(use) {
  if (["EATING PLACE","DRINK PLACES","LIQUOR","GAS SERV STA","GROCERIES"].includes(use)) return "Food & Drink";
  if (["MARINAS","OTHR MARINAS","RV PARKS"].includes(use)) return "Marine & RV";
  if (["GOLF COURSES","GEN RESORTS","TENNIS COURT"].includes(use)) return "Recreation";
  if (PARK_TYPES.has(use)) return "Parks";
  if (GOV_TYPES.has(use) || use === "OTHR GVRN SV") return "Government";
  if (["RE AG/BRKR/M","BANK SERV","OTHR FIN/INS"].includes(use)) return "Real Estate & Finance";
  if (["MINI STORAGE","WHSE/STORAGE","OTHR WHSE/ST"].includes(use)) return "Storage";
  if (["CHURCHES"].includes(use)) return "Religious";
  if (["DESIG FOREST","OSAG RANCHES","OTHR AG LAND"].includes(use)) return "Land";
  if (["ELEC SERV","ELEC REG SUB","PHONE COMMUN","PHONE RELAY","WATR STORAGE","WTR TREATMNT"].includes(use)) return "Utilities";
  return "Other Services";
}

function fmt$(v) {
  if (!v) return "—";
  return "$" + Number(v).toLocaleString();
}
function fmtSqft(v) {
  if (!v) return "—";
  return Number(v).toLocaleString() + " sqft";
}

// ── State ──────────────────────────────────────────────────────
let allFeatures = [];
let activeCategories = new Set();
let searchQuery = "";
let markers = {};
let currentPopupPropId = null;

// ── Build marker for a feature ─────────────────────────────────
function makeMarker(feature) {
  const p    = feature.properties;
  const ll   = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
  const col  = p.color || getColor(p.use);
  const size = p.is_reef ? 20 : 12;
  const weight = p.is_reef ? 3 : 1.5;
  const fillOpacity = p.is_reef ? 1 : 0.82;

  const marker = L.circleMarker(ll, {
    radius:      size,
    fillColor:   col,
    color:       p.is_reef ? "#f0c040" : "#fff",
    weight:      weight,
    opacity:     0.9,
    fillOpacity: fillOpacity,
  });

  const popup = L.popup({ className: '', maxWidth: 300, offset: [0, -4] })
    .setContent(buildPopup(p, col));

  marker.bindPopup(popup);
  marker.on('click', () => highlightListItem(p.prop_id));

  if (p.is_reef) {
    marker.bindTooltip("★ The Reef", {
      permanent: true,
      direction: "top",
      className: "",
      offset: [0, -16],
    });
  }

  return marker;
}

function buildPopup(p, color) {
  const useBadge = `<span class="popup-use-badge" style="background:${color}22;color:${color};border:1px solid ${color}55">${p.use}</span>`;
  return `
    <div class="popup-inner">
      ${useBadge}
      <div class="popup-address">${p.is_reef ? '★ ' : ''}${p.address}</div>
      <div class="popup-owner">${p.owner || '—'}</div>
      <div class="popup-stats">
        <div class="popup-stat"><div class="v">${fmt$(p.mkt_value)}</div><div class="k">Market Value</div></div>
        <div class="popup-stat"><div class="v">${fmtSqft(p.sqft)}</div><div class="k">Bldg Size</div></div>
        <div class="popup-stat"><div class="v">${p.yr_blt || '—'}</div><div class="k">Year Built</div></div>
        <div class="popup-stat"><div class="v">${p.zoning || '—'}</div><div class="k">Zoning</div></div>
      </div>
      ${p.county_url ? `<a class="popup-link" href="${p.county_url}" target="_blank">View County Record ↗</a>` : ''}
    </div>`;
}

// ── Load and render ────────────────────────────────────────────
fetch('businesses.geojson')
  .then(r => r.json())
  .then(geojson => {
    allFeatures = geojson.features;

    // Sort: reef first, then by market value desc
    allFeatures.sort((a, b) => {
      if (a.properties.is_reef) return -1;
      if (b.properties.is_reef) return  1;
      return (b.properties.mkt_value || 0) - (a.properties.mkt_value || 0);
    });

    // Build category set
    const cats = new Set(allFeatures.map(f => getCategory(f.properties.use)));
    activeCategories = new Set(cats);

    buildFilterPills([...cats].sort());
    buildLegend();
    renderAll();
    buildStatsBar();
  })
  .catch(err => {
    console.error("Failed to load businesses.geojson", err);
    document.getElementById('property-list').innerHTML =
      '<p style="color:#e74c3c;padding:16px;font-size:13px">Error loading data. Run: python -m http.server 8080</p>';
  });

// ── Filter pills ───────────────────────────────────────────────
function buildFilterPills(cats) {
  const container = document.getElementById('filter-pills');

  // "All" pill
  const allPill = document.createElement('span');
  allPill.className = 'pill active';
  allPill.textContent = 'All';
  allPill.style.cssText = 'background:#2a3f55;color:#b0c4d8;border-color:#3a5f80';
  allPill.addEventListener('click', () => {
    activeCategories = new Set(cats);
    document.querySelectorAll('.pill[data-cat]').forEach(p => p.classList.add('active'));
    allPill.classList.add('active');
    renderAll();
  });
  container.appendChild(allPill);

  cats.forEach(cat => {
    // pick a representative color for the pill
    const sampleFeature = allFeatures.find(f => getCategory(f.properties.use) === cat);
    const col = sampleFeature ? (sampleFeature.properties.color || getColor(sampleFeature.properties.use)) : "#607d8b";

    const pill = document.createElement('span');
    pill.className = 'pill active';
    pill.dataset.cat = cat;
    pill.textContent = cat;
    pill.style.cssText = `background:${col}22;color:${col};border-color:${col}55`;

    pill.addEventListener('click', () => {
      if (activeCategories.has(cat)) {
        activeCategories.delete(cat);
        pill.classList.remove('active');
      } else {
        activeCategories.add(cat);
        pill.classList.add('active');
      }
      renderAll();
    });
    container.appendChild(pill);
  });
}

// ── Legend ─────────────────────────────────────────────────────
function buildLegend() {
  const legendCats = [
    ["Food & Drink",  "#e74c3c"],
    ["Marine & RV",   "#2980b9"],
    ["Recreation",    "#1abc9c"],
    ["Parks",         "#27ae60"],
    ["Government",    "#3498db"],
    ["Real Estate",   "#16a085"],
    ["Storage",       "#95a5a6"],
    ["Utilities",     "#ff9800"],
    ["Target: Reef",  "#f0c040"],
  ];
  const cont = document.getElementById('legend-items');
  legendCats.forEach(([label, color]) => {
    cont.innerHTML += `
      <div class="legend-item">
        <span class="legend-dot" style="background:${color}"></span>
        ${label}
      </div>`;
  });
}

// ── Stats bar ──────────────────────────────────────────────────
function buildStatsBar() {
  const total = allFeatures.length;
  const totalVal = allFeatures.reduce((s, f) => s + (f.properties.mkt_value || 0), 0);
  const foodDrink = allFeatures.filter(f => ["EATING PLACE","DRINK PLACES"].includes(f.properties.use)).length;

  const bar = document.getElementById('stats-bar');
  bar.style.display = 'flex';
  bar.innerHTML = `
    <div class="stat-pill"><strong>${total}</strong> Properties</div>
    <div class="stat-pill"><strong>${fmt$(totalVal)}</strong> Total Assessed</div>
    <div class="stat-pill"><strong>${foodDrink}</strong> Eating/Drinking</div>
    <div class="stat-pill">Point Roberts, WA 98281</div>
  `;
}

// ── Render all markers + list ──────────────────────────────────
function renderAll() {
  // Determine visible features
  const q = searchQuery.toLowerCase();
  const visible = allFeatures.filter(f => {
    const p = f.properties;
    if (!activeCategories.has(getCategory(p.use))) return false;
    if (q && !(
      p.address.toLowerCase().includes(q) ||
      (p.owner || "").toLowerCase().includes(q) ||
      p.use.toLowerCase().includes(q)
    )) return false;
    return true;
  });

  // Remove old markers
  Object.values(markers).forEach(m => map.removeLayer(m));
  markers = {};

  // Add new markers
  visible.forEach(f => {
    const m = makeMarker(f);
    m.addTo(map);
    markers[f.properties.prop_id] = m;
  });

  // Render list
  buildList(visible);
}

// ── Property list ──────────────────────────────────────────────
function buildList(features) {
  const list = document.getElementById('property-list');
  document.getElementById('count-badge').textContent = features.length;
  list.innerHTML = '';

  features.forEach(f => {
    const p   = f.properties;
    const col = p.color || getColor(p.use);
    const el  = document.createElement('div');
    el.className = 'property-item' + (p.is_reef ? ' is-reef' : '');
    el.dataset.propId = p.prop_id;
    el.innerHTML = `
      <span class="dot" style="background:${col}"></span>
      <div class="prop-info">
        <div class="prop-address">${p.is_reef ? '★ ' : ''}${p.address}</div>
        <div class="prop-owner">${p.owner || '—'}</div>
      </div>
      <div class="prop-meta">
        <div class="prop-value">${fmt$(p.mkt_value)}</div>
        <div class="prop-use">${p.use}</div>
      </div>`;
    el.addEventListener('click', () => flyToProperty(f));
    list.appendChild(el);
  });
}

function flyToProperty(feature) {
  const ll = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
  const p  = feature.properties;

  map.flyTo(ll, 17, { animate: true, duration: 1 });
  setTimeout(() => {
    const m = markers[p.prop_id];
    if (m) m.openPopup();
  }, 900);

  highlightListItem(p.prop_id);
}

function highlightListItem(propId) {
  document.querySelectorAll('.property-item').forEach(el => el.classList.remove('selected'));
  const el = document.querySelector(`.property-item[data-prop-id="${propId}"]`);
  if (el) {
    el.classList.add('selected');
    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}

// ── Fly to Reef button ─────────────────────────────────────────
document.getElementById('fly-to-reef').addEventListener('click', () => {
  const reef = allFeatures.find(f => f.properties.is_reef);
  if (reef) flyToProperty(reef);
});

// ── Search ─────────────────────────────────────────────────────
document.getElementById('search-box').addEventListener('input', e => {
  searchQuery = e.target.value.trim();
  renderAll();
});
</script>
</body>
</html>
